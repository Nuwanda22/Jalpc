---
layout: post
title:  "데이터베이스 회복"
date:   2016-11-15
desc: "데이터베이스 회복에 대한 조사"
keywords: "database,sql,recovery"
categories: [Database]
tags: [database]
icon: fa-database
---

# 정의
데이터베이스 운영 도중 예기치 못한 장애가 발생할 경우, 데이터베이스를 장애 발생 이전의 상태로 복원시키는 것



  
# 장애

#### 트랜잭션 장애
내부적인 오류로 트랜잭션을 완료할 수 없거나, 시스템이 교착 상태와 같은 상태에 도달하여 트랜잭션을 완료할 수 없는 경우

#### 시스템 장애
하드웨어 실패나 DBMS, OS 오류로 인한 장애

#### 디스크 장애
디스크 블록이 헤드이 손상이나 고장으로 인해 내용이 손실되는 경우




# REDO와 UNDO 그리고 체크포인트

redo는 복구할때 사용자가 했던 작업을 그대로 다시 하지만

undo는 사용자가 햇던 작업을 반대로한다. 즉 사용자가 작업을 원상태로 돌린다.

간단히 말하자면 복구와 되돌리기인 것이다.

UNDO|REDO
----|----
되돌리기 위한 변화 | 재생하기 위한 변화
롤백, 읽기 일관성  | 복구
UNDO 세그먼트     | REDO 로그 파일
읽기 일관성을 보호 | 데이터 손실을 방지 


REDO, UNDO가 결정되는 기준은 다음과 같다.

* 체크 포인트 이전에 끝나면 아무것도 하지 않는다.
* 체크 포인트가 없거나 이후에 끝나면 전체 REDO한다.
* 체크 포인트가 중간에 걸친 경우, 체크 포인트 이후 부분만 REDO한다.
* 아직 끝나지 않은 경우, 체크포인트 여부와 상관없이 무조건 UNDO한다.

간단히 표로 나타내면 다음과 같다.

#### 체크 포인트가 없을때

트랜잭션|끝남|수행 중
--------|--------|--------
복구 | redo | undo

이미 끝났으면 redo, 수행 중이었으면 undo

#### 체크 포인트가 있을때
![체크포인트 그림](https://4.bp.blogspot.com/_o049WAyUHqI/S7GRZFNkcrI/AAAAAAAAAFM/ZeQ4-n42l4E/s1600/Picture13.gif)

체크포인트|이전에 끝남 (T1)|중간에 걸침 (T2)|이후에 끝남 (T3)|아직 끝나지 않음(T4)
---------|----------|----------|-----------|--------------
복구|아무것도 하지 않음|체크포인트 이후 부분만 REDO|전체 REDO|UNDO


# 회복 기법
* 즉시 갱신 회복 기법
* 체크 포인트 회복 기법
* 그림자 페이징 회복 기법
* 미디어 회복 기법